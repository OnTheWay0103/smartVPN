# SmartVPN - æ™ºèƒ½ä»£ç†ç³»ç»Ÿ

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Node.js](https://img.shields.io/badge/Node.js-12.0+-green.svg)](https://nodejs.org/)
[![Platform](https://img.shields.io/badge/Platform-Windows%20%7C%20macOS-blue.svg)](https://github.com/OnTheWay0103/smartVPN)

SmartVPN æ˜¯ä¸€ä¸ªåŸºäº Node.js å¼€å‘çš„æ™ºèƒ½ä»£ç†ç³»ç»Ÿï¼Œæ”¯æŒè‡ªåŠ¨è®¾ç½®ç³»ç»Ÿä»£ç†ã€TLS åŠ å¯†é€šä¿¡å’Œç™½åå•åŸŸåè¿‡æ»¤ã€‚è¯¥ç³»ç»ŸåŒ…å«æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸¤ä¸ªç»„ä»¶ï¼Œæä¾›å®‰å…¨ã€é«˜æ•ˆçš„ç½‘ç»œä»£ç†æœåŠ¡ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ”’ å®‰å…¨ç‰¹æ€§

- **TLS åŠ å¯†é€šä¿¡** - ä½¿ç”¨ TLS 1.2+ åŠ å¯†æ‰€æœ‰é€šä¿¡æ•°æ®
- **è¯ä¹¦éªŒè¯** - åŒå‘è¯ä¹¦éªŒè¯ç¡®ä¿è¿æ¥å®‰å…¨
- **ç™½åå•è¿‡æ»¤** - æ”¯æŒç²¾ç¡®åŒ¹é…å’Œé€šé…ç¬¦åŸŸåè¿‡æ»¤

### ğŸš€ è‡ªåŠ¨åŒ–åŠŸèƒ½

- **è‡ªåŠ¨ä»£ç†è®¾ç½®** - å¯åŠ¨æ—¶è‡ªåŠ¨é…ç½®ç³»ç»Ÿä»£ç†
- **æ™ºèƒ½æ¢å¤** - å…³é—­æ—¶è‡ªåŠ¨æ¢å¤åŸå§‹ä»£ç†è®¾ç½®
- **è·¨å¹³å°æ”¯æŒ** - æ”¯æŒ Windows å’Œ macOS ç³»ç»Ÿ

### ğŸ“Š ç›‘æ§ä¸æ—¥å¿—

- **å®æ—¶çŠ¶æ€ç›‘æ§** - æ˜¾ç¤ºè¿æ¥çŠ¶æ€å’Œæµé‡ä¿¡æ¯
- **è¯¦ç»†æ—¥å¿—è®°å½•** - æ”¯æŒä¸åŒçº§åˆ«çš„æ—¥å¿—è¾“å‡º
- **é”™è¯¯å¤„ç†** - å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- **Node.js**: 12.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **æ“ä½œç³»ç»Ÿ**: Windows 10/11 æˆ– macOS
- **æƒé™**: ç®¡ç†å‘˜æƒé™ï¼ˆç”¨äºä¿®æ”¹ç³»ç»Ÿä»£ç†è®¾ç½®ï¼‰
- **ç½‘ç»œ**: ç¨³å®šçš„ç½‘ç»œè¿æ¥

## ğŸ› ï¸ å®‰è£…æŒ‡å—

### 1. å…‹éš†é¡¹ç›®

```bash
git clone git@github.com:OnTheWay0103/smartVPN.git
cd smartVPN
```

### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

### 3. ç”Ÿæˆ TLS è¯ä¹¦

```bash
# è¿›å…¥è¯ä¹¦ç›®å½•
cd env

# ç”ŸæˆæœåŠ¡å™¨ç§é’¥å’Œè¯ä¹¦ç­¾åè¯·æ±‚
openssl req -newkey rsa:4096 -nodes -keyout server-key.pem -out server.csr -config openssl.cnf

# ç”ŸæˆæœåŠ¡å™¨è¯ä¹¦
openssl x509 -req -in server.csr -signkey server-key.pem -out server-cert.pem -extensions req_ext -extfile openssl.cnf -days 365

# ç”Ÿæˆå®¢æˆ·ç«¯ç§é’¥å’Œè¯ä¹¦ç­¾åè¯·æ±‚
openssl req -newkey rsa:4096 -nodes -keyout client-key.pem -out client.csr -config openssl.cnf

# ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦
openssl x509 -req -in client.csr -signkey client-key.pem -out client-cert.pem -extensions req_ext -extfile openssl.cnf -days 365
```

### 4. é…ç½®å®¢æˆ·ç«¯

å¤åˆ¶é…ç½®æ¨¡æ¿å¹¶ä¿®æ”¹ï¼š

```bash
cp env/config.example.js env/config.js
```

ç¼–è¾‘ `env/config.js` æ–‡ä»¶ï¼š

```javascript
module.exports = {
  // è¿œç¨‹æœåŠ¡å™¨é…ç½®
  remote: {
    host: "your-server-ip", // æ›¿æ¢ä¸ºæ‚¨çš„æœåŠ¡å™¨IP
    port: 443, // æœåŠ¡å™¨ç«¯å£
  },

  // æœ¬åœ°ä»£ç†é…ç½®
  local: {
    port: 8080, // æœ¬åœ°ä»£ç†ç«¯å£
  },

  // TLSè¯ä¹¦é…ç½®
  tls: {
    key: "./env/client-key.pem",
    cert: "./env/client-cert.pem",
    ca: "./env/server-cert.pem",
  },
};
```

### 5. é…ç½®ç™½åå•

ç¼–è¾‘ `whitelist.js` æ–‡ä»¶ï¼Œæ·»åŠ éœ€è¦ä»£ç†çš„åŸŸåï¼š

```javascript
module.exports = {
  domains: [
    "example.com", // ç²¾ç¡®åŒ¹é…
    "*.example.org", // é€šé…ç¬¦åŒ¹é…
    "api.example.net", // APIåŸŸå
  ],
};
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¯åŠ¨æœåŠ¡ç«¯

```bash
# åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ
npm run server
# æˆ–
node server.js
```

æœåŠ¡ç«¯å°†åœ¨æŒ‡å®šç«¯å£ï¼ˆé»˜è®¤ 888ï¼‰ç›‘å¬å®¢æˆ·ç«¯è¿æ¥ã€‚

### å¯åŠ¨å®¢æˆ·ç«¯

```bash
# åœ¨å®¢æˆ·ç«¯æœºå™¨ä¸Šè¿è¡Œ
npm start
# æˆ–
node client.js
```

å®¢æˆ·ç«¯å¯åŠ¨åä¼šï¼š

1. è‡ªåŠ¨è®¾ç½®ç³»ç»Ÿä»£ç†ä¸º `127.0.0.1:8080`
2. å¯åŠ¨æœ¬åœ°ä»£ç†æœåŠ¡å™¨
3. æ˜¾ç¤ºè¿æ¥çŠ¶æ€ä¿¡æ¯

### å…³é—­å®¢æˆ·ç«¯

æŒ‰ `Ctrl+C` æˆ–å…³é—­ç»ˆç«¯çª—å£ï¼Œå®¢æˆ·ç«¯ä¼šï¼š

1. è‡ªåŠ¨æ¢å¤åŸå§‹ç³»ç»Ÿä»£ç†è®¾ç½®
2. æ¸…ç†èµ„æºå¹¶é€€å‡º

## âš™ï¸ é…ç½®è¯´æ˜

### æœåŠ¡ç«¯é…ç½®

æœåŠ¡ç«¯é…ç½®åœ¨ `server.js` ä¸­ï¼š

```javascript
const SERVER_PORT = 888; // æœåŠ¡ç«¯ç›‘å¬ç«¯å£
```

### å®¢æˆ·ç«¯é…ç½®

å®¢æˆ·ç«¯é…ç½®åœ¨ `env/config.js` ä¸­ï¼š

| é…ç½®é¡¹        | è¯´æ˜               | é»˜è®¤å€¼                  |
| ------------- | ------------------ | ----------------------- |
| `remote.host` | è¿œç¨‹æœåŠ¡å™¨ IP åœ°å€ | -                       |
| `remote.port` | è¿œç¨‹æœåŠ¡å™¨ç«¯å£     | 443                     |
| `local.port`  | æœ¬åœ°ä»£ç†ç«¯å£       | 8080                    |
| `tls.key`     | å®¢æˆ·ç«¯ç§é’¥æ–‡ä»¶è·¯å¾„ | `./env/client-key.pem`  |
| `tls.cert`    | å®¢æˆ·ç«¯è¯ä¹¦æ–‡ä»¶è·¯å¾„ | `./env/client-cert.pem` |
| `tls.ca`      | æœåŠ¡å™¨è¯ä¹¦æ–‡ä»¶è·¯å¾„ | `./env/server-cert.pem` |

### ç™½åå•é…ç½®

ç™½åå•é…ç½®åœ¨ `whitelist.js` ä¸­ï¼š

- **ç²¾ç¡®åŒ¹é…**: `'example.com'` - åªä»£ç†æŒ‡å®šåŸŸå
- **é€šé…ç¬¦åŒ¹é…**: `'*.example.org'` - ä»£ç†æ‰€æœ‰å­åŸŸå

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ä»£ç†è®¾ç½®å¤±è´¥

**ç—‡çŠ¶**: æ— æ³•è®¾ç½®ç³»ç»Ÿä»£ç†

**è§£å†³æ–¹æ¡ˆ**:

- ç¡®ä¿ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œ
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
- éªŒè¯ `regedit.vbs` æ–‡ä»¶å­˜åœ¨ï¼ˆWindowsï¼‰

#### 2. è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: æ— æ³•è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨

**è§£å†³æ–¹æ¡ˆ**:

- æ£€æŸ¥è¿œç¨‹æœåŠ¡å™¨é…ç½®
- éªŒè¯ TLS è¯ä¹¦æ–‡ä»¶
- ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
- æ£€æŸ¥æœåŠ¡å™¨é˜²ç«å¢™è®¾ç½®

#### 3. è¯ä¹¦é”™è¯¯

**ç—‡çŠ¶**: TLS è¯ä¹¦éªŒè¯å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:

- ç¡®ä¿è¯ä¹¦æ–‡ä»¶å­˜åœ¨ä¸”è·¯å¾„æ­£ç¡®
- æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
- éªŒè¯è¯ä¹¦é…ç½®

### æ—¥å¿—çº§åˆ«

å¯ä»¥é€šè¿‡ä¿®æ”¹ `utils/logger.js` æ¥è°ƒæ•´æ—¥å¿—çº§åˆ«ï¼š

```javascript
const logLevel = "info"; // å¯é€‰: debug, info, warn, error
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
smartVPN/
â”œâ”€â”€ env/                    # é…ç½®å’Œè¯ä¹¦ç›®å½•
â”‚   â”œâ”€â”€ config.js          # å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ openssl.cnf        # OpenSSL é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ server-key.pem     # æœåŠ¡å™¨ç§é’¥
â”‚   â”œâ”€â”€ server-cert.pem    # æœåŠ¡å™¨è¯ä¹¦
â”‚   â”œâ”€â”€ client-key.pem     # å®¢æˆ·ç«¯ç§é’¥
â”‚   â””â”€â”€ client-cert.pem    # å®¢æˆ·ç«¯è¯ä¹¦
â”œâ”€â”€ utils/                  # å·¥å…·æ¨¡å—
â”‚   â””â”€â”€ logger.js          # æ—¥å¿—å·¥å…·
â”œâ”€â”€ regedit-vbs/           # Windows æ³¨å†Œè¡¨è„šæœ¬
â”œâ”€â”€ client.js              # å®¢æˆ·ç«¯ä¸»ç¨‹åº
â”œâ”€â”€ server.js              # æœåŠ¡ç«¯ä¸»ç¨‹åº
â”œâ”€â”€ setProxy.js            # ä»£ç†è®¾ç½®å·¥å…·
â”œâ”€â”€ whitelist.js           # ç™½åå•é…ç½®
â”œâ”€â”€ package.json           # é¡¹ç›®é…ç½®
â””â”€â”€ README.md              # é¡¹ç›®æ–‡æ¡£
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# å®‰è£…å¼€å‘ä¾èµ–
npm install

# è¿è¡Œæµ‹è¯•
npm test

# è¿è¡Œå®¢æˆ·ç«¯æµ‹è¯•
node client.test.js

# è¿è¡ŒæœåŠ¡ç«¯æµ‹è¯•
node server.test.js
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ“ æ”¯æŒ

å¦‚æœæ‚¨é‡åˆ°é—®é¢˜æˆ–æœ‰å»ºè®®ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤) éƒ¨åˆ†
2. æœç´¢ [Issues](https://github.com/OnTheWay0103/smartVPN/issues)
3. åˆ›å»ºæ–°çš„ Issue

## ğŸ”„ æ›´æ–°æ—¥å¿—

### v1.0.0

- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒ TLS åŠ å¯†é€šä¿¡
- è‡ªåŠ¨ä»£ç†è®¾ç½®åŠŸèƒ½
- ç™½åå•åŸŸåè¿‡æ»¤
- è·¨å¹³å°æ”¯æŒï¼ˆWindows/macOSï¼‰

---

**æ³¨æ„**: é¦–æ¬¡è¿è¡Œå¯èƒ½éœ€è¦ç®¡ç†å‘˜æƒé™æ¥ä¿®æ”¹ç³»ç»Ÿä»£ç†è®¾ç½®ã€‚è¯·ç¡®ä¿åœ¨å®‰å…¨çš„ç¯å¢ƒä¸­ä½¿ç”¨æœ¬è½¯ä»¶ã€‚
